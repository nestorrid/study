# 10. 更新与删除

### 基于id更新单条数据

```python

def test_update_user_by_id(session):
    result = session.execute(
        update(User).where(User.id == 1).values({
            'name': 'new name'
        })
    )
    user = session.get(User, 1)
    assert user.id == 1
    assert user.name == 'new name'
    assert result.rowcount == 1
```

## 批量修改数据

```python
def test_update_user_with_id_lt_10(session):
    result = session.execute(
        update(User).where(User.id < 10).values({
            'name': User.name + ' test update'
        })
    )
    print(result.rowcount)
    assert result.rowcount > 0
```

## 获取影响数据的行数

在执行`update`和`delete`语句时, `session.execute()`方法返回的结果会包含一个`rowcount`属性, 记录了影响的数据行数.

## 取影响的数据

也可以使用`returning`语句获取受影响的数据或者特定的字段

```python
def test_get_updated_user_id(session):
    result = session.scalars(
        update(User).where(User.name.contains('user')).values(
            {'name': 'new user name' + User.id}
        ).returning(User.id)
    ).all()
    print(result)
    assert len(result) > 0

```



