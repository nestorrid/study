# 自定义类型映射

如果希望将python类型映射为其他类型, 而不是默认的类型, 可以通过内置变量`type_annotation_map`来进行自定义.



```python
class Base(DeclarativeBase):
    type_annotation_map = {
        int: BIGINT,
        datetime.datetime: TIMESTAMP(timezone=True),
        str: String().with_variant(NVARCHAR, "mssql"),
    }


class SomeClass(Base):
    __tablename__ = "some_table"

    id: Mapped[int] = mapped_column(primary_key=True)
    date: Mapped[datetime.datetime]
    status: Mapped[str]
```



也可以通过类型注解进行常用类型的定义, 使其包含更多的信息, 方便重用.



```python
from decimal import Decimal
from typing_extensions import Annotated

str_30 = Annotated[str, 15]
str_50 = Annotated[str, 50]
dec_16_4 = Annotated[Decimal, 16]
dec_6_2 = Annotated[Decimal, 6]


class Base(DeclarativeBase):

    type_annotation_map = {
        str_30: String(30),
        str_50: String(50),
        dec_16_4: Numeric(16, 4),
        dec_6_2: Numeric(6, 2),
    }

    id: Mapped[int] = mapped_column(primary_key=True)


class TypeMapping(Base):
    """
    create table main.type_mapping
    (
        s1 VARCHAR(30)    not null,
        s2 VARCHAR(50)    not null,
        d1 NUMERIC(16, 4) not null,
        d2 NUMERIC(6, 2)  not null,
        id INTEGER        not null
            primary key
    );
    """

    __tablename__ = 'type_mapping'

    s1: Mapped[str_30]
    s2: Mapped[str_50]
    d1: Mapped[dec_16_4]
    d2: Mapped[dec_6_2]

```



同样, 也可以通过类型注解来映射整个字段定义



```python
intpk = Annotated[int, mapped_column(primary_key=True)]

timestamp = Annotated[
    datetime,
    mapped_column(nullable=False, server_default=func.current_timestamp())
]

update_timestamp = Annotated[
    datetime,
    mapped_column(
        nullable=False,
        server_default=func.now(),
        server_onupdate=func.now()
    ),
]

```

